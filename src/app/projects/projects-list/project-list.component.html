<section class="page">
  <header class="page-header">
    <div>
      <p class="eyebrow">Projects</p>
      <h1>Active renovations</h1>
      <p class="subtitle">Track budget, address, contractor and progress at a glance.</p>
    </div>
    <div class="header-actions">
      <a routerLink="/" class="home-link">Home</a>
      <button type="button" class="refresh-btn" (click)="refreshProjects()" [disabled]="loading">
        {{ loading ? 'Refreshing...' : 'Refresh' }}
      </button>
    </div>
  </header>

  <div *ngIf="loading" class="status state-loading">
    <span class="dot"></span>
    <span>Loading projects...</span>
  </div>

  <div *ngIf="errorMessage" class="status state-error">
    {{ errorMessage }}
  </div>

  <div *ngIf="!loading && !errorMessage && contractorsError" class="status state-error">
    {{ contractorsError }}
  </div>

  <div *ngIf="!loading && !errorMessage && projects.length === 0" class="status state-empty">
    No projects found yet. Start by creating your first renovation job.
  </div>

  <ul *ngIf="!loading && !errorMessage && projects.length > 0" class="project-grid">
    <li class="project-card"
        *ngFor="let project of projects"
        role="button"
        tabindex="0"
        [attr.aria-label]="'Open project ' + (project.name || 'details')"
        (click)="goToDetails(project)"
        [class.project-card--finished]="isFinished(project)">
      <div class="project-card__header">
        <h3 [class.project-card__title--finished]="isFinished(project)">{{ project.name }}</h3>
        <span class="project-card__eta project-card__eta--done" *ngIf="isFinished(project)">
          Completed
        </span>
        <span class="project-card__eta" *ngIf="!isFinished(project) && getEtaDays(project) !== undefined">
          ETA {{ getEtaDays(project) }} day{{ getEtaDays(project) === 1 ? '' : 's' }}
        </span>
      </div>

      <dl class="project-card__meta">
        <div>
          <dt>Address</dt>
          <dd>{{ project.address || 'N/A' }}</dd>
        </div>
        <div>
          <dt>Budget</dt>
          <dd>{{ project.budget | currency:'USD':'symbol-narrow':'1.0-0' }}</dd>
        </div>
        <div>
          <dt>Contractor</dt>
          <dd>{{ project.contractorName || project.contractor || 'Unassigned' }}</dd>
        </div>
      </dl>

      <div class="progress">
        <div class="progress__label">
          <span>Progress</span>
          <span>{{ getProgressValue(project) }}%</span>
        </div>
        <div class="progress__track">
          <div class="progress__fill" [style.width.%]="getProgressValue(project)"></div>
        </div>
      </div>
    </li>
  </ul>
</section>

HomeReno Frontend Documentation
===============================

Overview
--------
HomeReno is an Angular frontend for planning and tracking home renovation projects. The app covers project creation, contractor assignment, task tracking, progress and ETA estimation, and map-based location management.

Goals
-----
- Provide an easy way to create and manage renovation projects.
- Track tasks and project completion.
- Visualize project locations on a map.
- Keep the UI responsive and clear on desktop and mobile.

Tech Stack
----------
- Angular with standalone components and Angular Router.
- TypeScript and RxJS.
- Leaflet for maps.
- OpenStreetMap Nominatim for geocoding.

Running the App
---------------
- ng serve
- Frontend default: http://localhost:4200

Configuration and API Key
-------------------------
- API base URL and API key are loaded at startup from public/config.json.
- Default dev key: dev-local-key.
- Local override: public/config.local.json (gitignored) with apiBaseUrl and apiKey.
- X-API-KEY is attached to same-origin requests (including /api/** and /uploads/**).
- Authorization: Bearer <jwt> is attached to /api/** except /api/auth/** and /uploads/**.
- /uploads/** is public, but still receives X-API-KEY when same-origin.

Backend
-------
- Backend repo: https://github.com/niko78900/RenoAPI
- Base URL: http://localhost:8080
- CORS is expected for http://localhost:4200
- Backend expects X-API-KEY on /api/** requests and JWT for non-auth endpoints.

Project Structure (frontend)
----------------------------
- src/app/config/app-config.ts: runtime API configuration loader
- src/app/interceptors/api-key.interceptor.ts: attaches X-API-KEY and JWT headers
- src/app/app.routes.ts: route table
- src/app/auth/: login, register, and pending approval pages
- src/app/admin/: admin approval UI
- src/app/guards/: auth and admin route guards
- src/app/home/: landing page and map overview
- src/app/projects/projects-list/: list view
- src/app/projects/project-details/: details, settings, and tasks
- src/app/projects/project-create/: create flow
- src/app/projects/location-map/: Leaflet map component
- src/app/projects/models/: Project, Task, Contractor, and Image interfaces
- src/app/projects/utils/: ETA calculation utilities
- src/app/services/: API, image, and geocoding services
- src/styles.css: theme and global styling
- public/: static assets and runtime config
- Documentation/: requirements and notes

Routing
-------
- /login -> LoginComponent
- /register -> RegisterComponent
- /pending -> PendingApprovalComponent
- / -> HomeComponent (map overview, auth required)
- /projects -> ProjectListComponent (auth required)
- /projects/new -> ProjectCreateComponent (auth required)
- /projects/:id -> ProjectDetailsComponent (auth required)
- /admin/users -> AdminPendingUsersComponent (admin only)

Authentication and Roles
------------------------
- Auth endpoints: /api/auth/register and /api/auth/login.
- Pending accounts return enabled=false on register; login returns 403 until approved.
- Session data (token, username, role) is stored in localStorage.
- AuthGuard protects project routes; AdminGuard protects /admin/users.
- 401 responses clear session and redirect to /login.

Data Models
-----------
Project:
- id (string)
- name, budget, progress, finished
- contractorId, contractorName, contractor (legacy field for request and response compatibility)
- address, latitude, longitude
- eta, number_of_workers, numberOfWorkers
- taskIds

Task:
- id, projectId, name, status

Contractor:
- id, fullName, price, expertise (JUNIOR | APPRENTICE | SENIOR)

ProjectImage:
- id, projectId, url
- description, uploadedAt, uploadedBy

ID Normalization
----------------
- Backend may return Mongo-style _id. Services map _id -> id so components use id only.
- Project normalization also maps contractorId from responses and mirrors it to contractor for legacy usage.
- Components should never reference _id.

API Integration (used by frontend)
----------------------------------
Auth
- POST /api/auth/register
- POST /api/auth/login

Admin
- GET /api/admin/users/pending
- POST /api/admin/users/{id}/approve

Projects
- GET /api/projects
- GET /api/projects/{id}
- GET /api/projects/with-coordinates (optional; falls back to GET /api/projects)
- POST /api/projects
- PATCH /api/projects/{id}/name
- PATCH /api/projects/{id}/address
- PATCH /api/projects/{id}/budget
- PATCH /api/projects/{id}/progress
- PATCH /api/projects/{id}/workers
- PATCH /api/projects/{id}/eta
- PATCH /api/projects/{id}/finished
- PATCH /api/projects/{id}/contractor
- PATCH /api/projects/{id}/contractor/remove
- POST /api/projects/{projectId}/tasks
- DELETE /api/projects/{projectId}/tasks/{taskId}

Tasks
- GET /api/tasks
- GET /api/tasks/{id}
- GET /api/tasks/project/{projectId}
- POST /api/tasks
- PUT /api/tasks/{id}
- DELETE /api/tasks/{id}

Contractors
- GET /api/contractors
- GET /api/contractors/{id}
- GET /api/contractors/expertise
- POST /api/contractors
- DELETE /api/contractors/{id}

Images
- GET /api/images/project/{projectId}
- POST /api/images/upload (multipart/form-data: projectId, file, description?)
- POST /api/images (JSON: projectId, url, description?)
- DELETE /api/images/{id}
- Uploads are capped at 50 images per project (backend returns 400 when exceeded).
- Backend validates image bytes; spoofed files return 400.

Request vs response naming
--------------------------
- Project requests use contractor and number_of_workers (snake case).
- Project responses use contractorId, contractorName, and numberOfWorkers (camel case).
- Task uses projectId for both request and response.

Core UI Flows
-------------
Home (map overview)
- Loads the project list, filters for items with coordinates, and renders markers.
- Marker interactions are handled inside the map component.

Project list
- Shows project cards with progress, ETA, contractor, and status.
- ETA is computed from baseline eta plus workers, progress, and contractor expertise.

Project create
- Reactive form with budget, eta, contractor selection, and address.
- Auto-calculates workers from budget.
- Geocoding runs as the address changes; manual marker placement is supported.
- On save, sends contractor and number_of_workers as required by the backend.

Project details
- Settings modal allows updates to name, address, budget, workers, progress, eta, and contractor.
- Task panel supports create, update status, and delete.
- Finish project uses the explicit /finished endpoint.
- Address changes trigger geocoding; opening settings does not move the marker unless the user edits the address.
- Manage images modal shows the image gallery, upload form, delete actions, and full-size preview.
- Image uploads pre-check the current image count and block at 50 with a clear message.
- If file type is missing/unknown, the UI warns and the backend still validates image bytes.

Map and Geocoding Behavior
--------------------------
- Geocoding uses Nominatim (OpenStreetMap) with a debounced request stream.
- Only the latest address input updates coordinates.
- Clearing the address clears coordinates and pending state.
- Manual marker moves set a pending state that only persists when the user saves.
- Project details respects existing coordinates unless the address changes.

Keyboard Navigation
-------------------
- Arrow keys move focus between interactive elements (use either Left/Right or Up/Down).
- Enter activates the focused control (buttons and links).
- Backspace navigates back a page when focus is not inside an input, textarea, or select.
- Select fields use a two-mode behavior: press Enter/Space to edit the select, use Arrow keys to change options, then press Enter, Escape, or Tab to exit edit mode and continue navigation.
- The map can be focused for visual feedback, but marker placement/dragging still requires a mouse.

State Management
----------------
- No global store; state is managed in components with RxJS and Angular Reactive Forms.
- Services return normalized data models.
- Local flags track loading, saving, and validation errors.

Error Handling and UX
---------------------
- Each major async path has loading and error states.
- Failed geocoding shows a friendly message and keeps the marker manual.
- API errors are logged and surfaced in the UI where appropriate.
- Image requests show status-aware errors for 400, 401, 404, and 500 responses.
- Upload 400s surface "Invalid image file or limit exceeded."

Requirements Alignment (frontend guidelines)
--------------------------------------------
- Component-based architecture: home, list, details, create, map, and shared utilities.
- Client-side routing with multiple views.
- Reactive forms and local state management appropriate to app complexity.
- Responsive layout with dedicated styles for cards, modals, and maps.
- Interaction beyond CRUD: live ETA calculation, map marker drag, geocoding, task-driven progress.
- Asynchronous data handling via HttpClient and RxJS.

Known Limitations and Assumptions
---------------------------------
- Backend is required for full functionality; it is provided in the RenoAPI repo.
- Project and task consistency follow backend behavior (project.taskIds is authoritative).
- Geocoding depends on third-party availability (Nominatim).
